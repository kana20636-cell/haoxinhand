<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>å¥½å¿ƒæ‰‹ä½œç®¡ç†ç³»çµ±</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    
    <style>
        body { background-color: #F8F9FA; color: #4A4A4A; font-family: "PingFang TC", sans-serif; padding-top: env(safe-area-inset-top); }
        .sidebar { transition: all 0.3s ease; width: 260px; min-width: 260px; height: 100vh; position: sticky; top: 0; background: white; display: flex; flex-direction: column; border-right: 1px solid #EEE; }
        .sidebar.collapsed { width: 0; min-width: 0; overflow: hidden; border: none; }
        .sidebar-content { flex: 1; overflow-y: auto; padding: 1.5rem; } 
        .nav-btn { width: 100%; text-align: left; padding: 0.8rem 1rem; border-radius: 0.8rem; margin-bottom: 0.4rem; font-weight: bold; }
        .nav-btn.active { background-color: #8E9775; color: white; }
        .card { background: white; border-radius: 1.2rem; padding: 1.5rem; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 1.5rem; }
        input, select { border: 1px solid #DDD; padding: 0.6rem; border-radius: 0.6rem; width: 100%; margin-bottom: 0.5rem; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
    </style>
</head>
<body class="flex">
    <aside id="sidebar" class="sidebar shadow-lg z-50">
        <div class="sidebar-content">
            <h1 class="text-xl font-black mb-6 text-[#8E9775] tracking-widest px-2">å¥½å¿ƒæ‰‹ä½œ</h1>
            <nav id="nav-list">
                <button onclick="showTab('orders')" class="nav-btn active">è¨‚å–®ç®¡ç†</button>
                <button onclick="showTab('inventory')" class="nav-btn">é€²è²¨ç®¡ç†</button>
                <button onclick="showTab('items')" class="nav-btn">å“é …ç®¡ç†</button>
                <button onclick="showTab('rank')" class="nav-btn">éŠ·å”®æ’è¡Œ</button>
            </nav>
        </div>
    </aside>

    <main class="flex-1 p-4 md:p-8">
        <button id="toggleBtn" onclick="toggleSidebar()" class="mb-4 bg-white border px-4 py-2 rounded-lg shadow-sm font-bold text-[#8E9775]">é—œé–‰é¸å–®</button>

        <section id="orders" class="tab-content active">
            <h2 class="text-xl font-bold mb-4 text-[#8E9775]">è¨‚å–®ç®¡ç†</h2>
            <div class="card bg-[#F3F5F0]">
                <h3 class="font-bold mb-2">ï¼‹ å»ºç«‹æ–°è¨‚å–®</h3>
                <input type="date" id="orderDate">
                <input type="text" id="custName" placeholder="é¡§å®¢å§“å">
                <select id="orderItemSelect"><option value="">é¸æ“‡å“é …</option></select>
               <input type="number" id="orderPrice" placeholder="éŠ·å”®é‡‘é¡">
                <select id="orderSource">
                    <option value="ç¤¾ç¾¤">ä¾†æºï¼šç¤¾ç¾¤</option>
                    <option value="LINE">ä¾†æºï¼šLINE</option>
                    <option value="FB/IG">ä¾†æºï¼šFB/IG</option>
                </select>
                <button onclick="addNewOrder()" class="w-full bg-[#8E9775] text-white py-2 rounded-lg font-bold">ç¢ºèªå„²å­˜è¨‚å–®</button>
            </div>
            <div id="orderListDisplay" class="space-y-2"></div>
        </section>

        <section id="inventory" class="tab-content">
            <h2 class="text-xl font-bold mb-4 text-[#4A90E2]">é€²è²¨ç®¡ç†</h2>
            <div class="card bg-[#EAF0F6]">
                <h3 class="font-bold mb-2">ï¼‹ ç´€éŒ„é€²è²¨ç´€éŒ„</h3>
                <input type="date" id="invDate">
                <input type="text" id="invName" placeholder="ææ–™åç¨±">
                <div class="flex gap-2">
                    <input type="number" id="invQty" placeholder="æ•¸é‡">
                    <input type="text" id="invUnit" placeholder="å–®ä½ (å¦‚:æ–¤)">
                </div>
                <input type="number" id="invPrice" placeholder="é€²è²¨ç¸½é¡">
                <button onclick="addInventory()" class="w-full bg-[#4A90E2] text-white py-2 rounded-lg font-bold">ç¢ºèªå­˜å…¥é€²è²¨</button>
            </div>
            <div id="inventoryListDisplay" class="space-y-2"></div>
        </section>

        <section id="items" class="tab-content">
            <h2 class="text-xl font-bold mb-4">å“é …ç®¡ç†</h2>
            <div class="card bg-[#F3F5F0]">
                <h3 class="font-bold mb-2 text-[#8E9775]">åˆ†é¡è¨­å®š</h3>
                <div class="flex gap-2"><input type="text" id="newCat" placeholder="æ–°åˆ†é¡"><button onclick="addCat()" class="bg-[#8E9775] text-white px-4 py-2 rounded-lg">æ–°å¢</button></div>
                <div id="catList" class="flex flex-wrap gap-2 mt-2"></div>
            </div>
            <div class="card">
                <h3 class="font-bold mb-2 text-[#8E9775]">ç”¢å“æ¸…å–® (è¦æ ¼èˆ‡å”®åƒ¹)</h3>
                <select id="itemCatSelect"><option value="">é¸æ“‡åˆ†é¡</option></select>
                <input type="text" id="itemName" placeholder="ç”¢å“åç¨±">
                <div class="flex gap-2"><input type="number" id="itemQty" placeholder="æ•¸é‡"><input type="text" id="itemUnit" placeholder="å–®ä½"></div>
                <input type="number" id="itemPrice" placeholder="é è¨­å”®åƒ¹">
                <button onclick="addItem()" class="w-full bg-[#8E9775] text-white py-2 rounded-lg font-bold">å­˜å…¥å“é …åº«</button>
                <div id="itemsListDisplay" class="mt-4"></div>
            </div>
        </section>

        <section id="rank" class="tab-content"><h2 class="text-xl font-bold">ğŸ† éŠ·å”®æ’è¡Œ</h2><div id="rankList"></div></section>
    </main>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyA9tMo62e3zhf0qR9lgcHE-YMIh5eaZ8dk",
            authDomain: "haoxin-44098.firebaseapp.com",
            databaseURL: "https://haoxin-44098-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "haoxin-44098",
            storageBucket: "haoxin-44098.firebasestorage.app",
            messagingSenderId: "878734507134",
            appId: "1:878734507134:web:91598cf6816d401e66ac2f"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        function toggleSidebar() {
            const sb = document.getElementById('sidebar');
            const btn = document.getElementById('toggleBtn');
            sb.classList.toggle('collapsed');
            btn.innerText = sb.classList.contains('collapsed') ? "é–‹å•Ÿé¸å–®" : "é—œé–‰é¸å–®";
        }

        function showTab(id) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            event.currentTarget.classList.add('active');
        }

        // --- 1. è¨‚å–®ç®¡ç† (éŠ·è²¨) ---
        function addNewOrder() {
            const d = {
                date: document.getElementById('orderDate').value,
                cust: document.getElementById('custName').value,
                item: document.getElementById('orderItemSelect').value,
                price: parseFloat(document.getElementById('orderPrice').value || 0)
            };
            if(d.cust && d.item) db.ref('orders').push(d).then(() => alert('è¨‚å–®å·²å„²å­˜'));
        }

        db.ref('orders').on('value', snap => {
            const list = document.getElementById('orderListDisplay');
            list.innerHTML = "";
            const data = snap.val();
            if(data) Object.keys(data).forEach(id => {
                const o = data[id];
                list.innerHTML += `<div class="card py-3 flex justify-between items-center text-sm border-l-4 border-[#8E9775]">
                    <div><b>${o.cust}</b> - ${o.item}<br><small>${o.date}</small></div>
                    <div class="font-bold text-[#8E9775]">$${o.price} 
                        <button onclick="editOrder('${id}',${o.price})" class="text-blue-500 ml-2">æ”¹åƒ¹</button>
                        <button onclick="del('orders','${id}')" class="text-red-400 ml-1">Ã—</button>
                    </div></div>`;
            });
        });
        function editOrder(id, p) { const np = prompt("ä¿®æ”¹è¨‚å–®é‡‘é¡:", p); if(np) db.ref('orders/'+id).update({ price: parseFloat(np) }); }

        // --- 2. é€²è²¨ç®¡ç† (è²·ææ–™) ---
        function addInventory() {
            const d = {
                date: document.getElementById('invDate').value,
                name: document.getElementById('invName').value,
                qty: document.getElementById('invQty').value,
                unit: document.getElementById('invUnit').value,
                price: parseFloat(document.getElementById('invPrice').value || 0)
            };
            if(d.name) db.ref('inventory').push(d).then(() => alert('é€²è²¨ç´€éŒ„å·²å­˜æª”'));
        }

        db.ref('inventory').on('value', snap => {
            const list = document.getElementById('inventoryListDisplay');
            list.innerHTML = "";
            const data = snap.val();
            if(data) Object.keys(data).forEach(id => {
                const v = data[id];
                list.innerHTML += `<div class="card py-3 flex justify-between items-center text-sm border-l-4 border-[#4A90E2]">
                    <div><b>${v.name}</b> (${v.qty}${v.unit})<br><small>${v.date}</small></div>
                    <div class="font-bold text-[#4A90E2]">$${v.price} <button onclick="del('inventory','${id}')" class="text-red-400 ml-2">Ã—</button></div></div>`;
            });
        });

        // --- 3. å“é …ç®¡ç†é‚è¼¯ ---
        function addCat() { const n = document.getElementById('newCat').value; if(n) db.ref('categories').push(n); document.getElementById('newCat').value = ''; }
        db.ref('categories').on('value', snap => {
            const list = document.getElementById('catList'); const sel = document.getElementById('itemCatSelect');
            list.innerHTML = ""; sel.innerHTML = '<option value="">é¸æ“‡åˆ†é¡</option>';
            if(snap.val()) Object.keys(snap.val()).forEach(id => {
                const n = snap.val()[id];
                list.innerHTML += `<span class="bg-white border px-2 py-1 rounded text-sm">${n} <button onclick="del('categories','${id}')" class="text-red-400">Ã—</button></span>`;
                sel.innerHTML += `<option value="${n}">${n}</option>`;
            });
        });

        function addItem() {
            const c = document.getElementById('itemCatSelect').value; const n = document.getElementById('itemName').value;
            const q = document.getElementById('itemQty').value; const u = document.getElementById('itemUnit').value;
            const p = document.getElementById('itemPrice').value;
            if(c && n) db.ref('items').push({ cat: c, name: n, qty: q, unit: u, price: p });
        }
        db.ref('items').on('value', snap => {
            const list = document.getElementById('itemsListDisplay'); const oSel = document.getElementById('orderItemSelect');
            list.innerHTML = ""; oSel.innerHTML = '<option value="">é¸æ“‡å“é …</option>';
            if(snap.val()) Object.keys(snap.val()).forEach(id => {
                const i = snap.val()[id];
                const spec = `${i.qty || ''}${i.unit || ''}`;
                list.innerHTML += `<div class="flex justify-between border-b py-2 text-sm">
                    <span>[${i.cat}] ${i.name} (${spec}) - $${i.price}</span>
                    <button onclick="del('items','${id}')" class="text-red-400">åˆªé™¤</button></div>`;
                oSel.innerHTML += `<option value="${i.name} (${spec})">${i.name} (${spec})</option>`;
            });
        });

        function del(p, id) { if(confirm("ç¢ºå®šåˆªé™¤æ­¤ç­†è³‡æ–™ï¼Ÿ")) db.ref(p+'/'+id).remove(); }
    </script>
</body>
</html>
