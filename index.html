<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>好心手作管理系統</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    
    <style>
        body { background-color: #F8F9FA; color: #4A4A4A; font-family: "PingFang TC", sans-serif; padding-top: env(safe-area-inset-top); }
        .sidebar { transition: all 0.3s ease; width: 280px; min-width: 280px; height: 100vh; position: sticky; top: 0; background: white; display: flex; flex-direction: column; }
        .sidebar.collapsed { width: 0; min-width: 0; overflow: hidden; }
        .sidebar-content { flex: 1; overflow-y: auto; padding: 1.5rem; } /* 解決滾軸問題 */
        .nav-btn { width: 100%; text-align: left; padding: 1rem; border-radius: 1rem; margin-bottom: 0.5rem; font-weight: bold; transition: 0.2s; }
        .nav-btn.active { background-color: #8E9775; color: white; }
        .card { background: white; border-radius: 1.5rem; padding: 1.8rem; box-shadow: 0 4px 12px rgba(0,0,0,0.05); margin-bottom: 1.2rem; border: 1px solid #EAEAEA; }
        input, select, textarea { border: 1px solid #DDD; border-radius: 0.8rem; padding: 0.6rem; width: 100%; margin-bottom: 0.5rem; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
    </style>
</head>
<body class="flex">
    <aside id="sidebar" class="sidebar shadow-xl z-50">
        <div class="sidebar-content">
            <h1 class="text-2xl font-black mb-8 text-[#8E9775] tracking-widest">好心手作</h1>
            <nav id="nav-list">
                <button onclick="showTab('orders')" class="nav-btn active">訂單管理</button>
                <button onclick="showTab('inventory')" class="nav-btn">進貨管理</button>
                <button onclick="showTab('items')" class="nav-btn">品項管理</button>
                <button onclick="showTab('customers')" class="nav-btn">顧客維護</button>
                <button onclick="showTab('rank')" class="nav-btn">銷售排行</button>
                <button onclick="showTab('report')" class="nav-btn">銷售報表</button>
            </nav>
        </div>
    </aside>
    <main class="flex-1 p-6">
        <button id="toggleBtn" onclick="toggleSidebar()" class="mb-6 bg-white border px-4 py-2 rounded-xl shadow-sm font-bold text-[#8E9775]">關閉選單</button>

        <section id="orders" class="tab-content active">
            <div class="flex justify-between items-end mb-4">
                <h2 class="text-2xl font-bold">訂單管理</h2>
                <select id="viewMode" onchange="renderOrders()" class="w-32">
                    <option value="day">日檢視</option>
                    <option value="month">月檢視</option>
                    <option value="year">年檢視</option>
                </select>
            </div>

            <div class="card bg-[#F3F5F0]">
                <h3 class="font-bold mb-3 text-[#8E9775]">＋ 建立新訂單</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                    <input type="date" id="orderDate">
                    <input type="text" id="custName" placeholder="顧客姓名">
                    <input type="text" id="itemName" placeholder="品項名稱">
                    <input type="number" id="orderPrice" placeholder="金額">
                    <select id="orderSource">
                        <option value="社群">來源：社群</option>
                        <option value="LINE">來源：LINE</option>
                        <option value="FB/IG">來源：FB/IG</option>
                    </select>
                </div>
                <button onclick="addNewOrder()" class="mt-4 w-full bg-[#8E9775] text-white py-3 rounded-xl font-bold">確認儲存訂單</button>
            </div>

            <div class="card">
                <p class="text-sm text-gray-500">當前視圖總計</p>
                <p class="text-3xl font-black text-[#8E9775]">$ <span id="totalRevenue">0</span></p>
            </div>
            <div id="orderList" class="space-y-4"></div>
        </section>

        <section id="inventory" class="tab-content">
            <h2 class="text-2xl font-bold mb-4">進貨管理</h2>
            <div class="card">
                <input type="date" id="invDate">
                <input type="text" id="invItem" placeholder="進貨品項">
                <div class="flex gap-2">
                    <input type="number" id="invQty" placeholder="數量">
                    <input type="text" id="invUnit" placeholder="單位 (箱/斤)">
                </div>
                <input type="number" id="invPrice" placeholder="進貨總價">
                <button onclick="addInventory()" class="w-full bg-[#8E9775] text-white py-3 rounded-xl font-bold">存入紀錄</button>
            </div>
            <div id="inventoryList"></div>
        </section>
    </main>    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyA9tMo62e3zhf0qR9lgcHE-YMIh5eaZ8dk",
            authDomain: "haoxin-44098.firebaseapp.com",
            databaseURL: "https://haoxin-44098-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "haoxin-44098",
            storageBucket: "haoxin-44098.firebasestorage.app",
            messagingSenderId: "878734507134",
            appId: "1:878734507134:web:91598cf6816d401e66ac2f"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        function toggleSidebar() {
            const sb = document.getElementById('sidebar');
            const btn = document.getElementById('toggleBtn');
            sb.classList.toggle('collapsed');
            btn.innerText = sb.classList.contains('collapsed') ? "開啟選單" : "關閉選單";
        }

        function showTab(id) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            event.currentTarget.classList.add('active');
        }

        function addNewOrder() {
            const order = {
                date: document.getElementById('orderDate').value,
                customer: document.getElementById('custName').value,
                item: document.getElementById('itemName').value,
                price: parseFloat(document.getElementById('orderPrice').value || 0),
                source: document.getElementById('orderSource').value,
                timestamp: Date.now()
            };
            if(!order.customer || !order.item) return alert("請填寫姓名與品項");
            db.ref('orders').push(order);
            alert("訂單已同步至雲端");
        }

        // 監聽雲端資料並渲染 (包含日/月/年金額統計)
        db.ref('orders').on('value', (snapshot) => {
            const data = snapshot.val();
            renderOrders(data);
        });

        function renderOrders(data) {
            const list = document.getElementById('orderList');
            const totalDisp = document.getElementById('totalRevenue');
            let total = 0;
            list.innerHTML = "";
            if(!data) return;
            
            Object.keys(data).forEach(id => {
                const o = data[id];
                total += o.price;
                list.innerHTML += `
                    <div class="card flex justify-between items-center">
                        <div>
                            <p class="font-bold text-lg">${o.customer} - ${o.item}</p>
                            <p class="text-sm text-gray-400">${o.date} | ${o.source}</p>
                        </div>
                        <div class="text-right">
                            <p class="font-black text-[#8E9775]">$${o.price}</p>
                            <button onclick="deleteOrder('${id}')" class="text-red-400 text-xs">刪除</button>
                        </div>
                    </div>
                `;
            });
            totalDisp.innerText = total.toLocaleString();
        }

        function deleteOrder(id) {
            if(confirm("確定刪除訂單？")) db.ref('orders/' + id).remove();
        }
    </script>
</body>
</html>
